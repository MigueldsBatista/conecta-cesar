{% extends 'app_cc/professor/mainp.html' %}
{% load i18n %}
{% load static %}
{% block content %}

{% if messages %}
<div>
    {% for message in messages %}
        <div 
            class="alert alert-{% if 'success' in message.tags %}success{% elif 'error' in message.tags %}danger{% elif 'warning' in message.tags %}warning{% else %}info{% endif %}  fade show" 
            role="alert">
            {{ message }}
        </div>
    {% endfor %}
</div>
{% endif %}

<div id="eventDetails" class="event-details event-text">
       
        <ul id="eventList"></ul>
    </div>
<section>
    <div class="box">
        <div class="container-calendar">
            <div class="calendar">
                <div class="month">
                    <i class="fas fa-angle-left prev"></i>
                    <div class="date">
                        <h1 class='header'></h1>
                        <h2 class='header'></h2>
                        <p></p>
                    </div>
                    <i class="fas fa-angle-right next"></i>
                </div>
                <div class="weekdays">
                    <div>{% trans "DOM" %}</div>
                    <div>{% trans "SEG" %}</div>
                    <div>{% trans "TER" %}</div>
                    <div>{% trans "QUA" %}</div>
                    <div>{% trans "QUI" %}</div>
                    <div>{% trans "SEX" %}</div>
                    <div>{% trans "SAB" %}</div>
                </div>
                <div class="days"></div>
            </div>
        </div>
    </div>
</section>

<div class="event-container">
    <div id="eventForm" class="event-form" style="display: none;">
        <form method="post" id="addEventForm">
            {% csrf_token %}
            <label for="titulo">{% trans "Título:" %}</label><br>
            <input type="text" id="titulo" name="titulo" required><br>

            <label for="descricao">{% trans "Descrição" %}:</label><br>
            <textarea name="descricao"></textarea><br>

            <label for="data">{% trans "Data" %}:</label><br>
            <input type="date" name="data" id="data" required><br>

            <label for="horario">{% trans "Horário" %}:</label><br>
            <input type="time" name="horario"><br>

            <label for="disciplina">{% trans "Disciplina" %}:</label>
            <select name="disciplina" id="disciplina" required>
                {% for disciplina in disciplinas %}
                    <option value="{{ disciplina.id }}">{{ disciplina.nome }}</option>
                {% endfor %}
            </select><br>

            <button type="submit">{% trans "Enviar" %}</button>
        </form>
    </div>

    
</div>

<script>
    const events = {{ eventos_json|safe }};
    const date = new Date();
    const dateBr = {weekday: 'short', year: 'numeric', month: 'short', day: 'numeric'};

    const renderCalendar = () => {
        date.setDate(1);
        const monthDays = document.querySelector(".days");
        const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
        const prevLastDay = new Date(date.getFullYear(), date.getMonth(), 0).getDate();
        const firstDayIndex = date.getDay();
        const lastDayIndex = new Date(date.getFullYear(), date.getMonth() + 1, 0).getDay();
        const nextDays = 7 - lastDayIndex - 1;

        const months = [
            "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
            "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
        ];

        document.querySelector(".date h1").innerHTML = months[date.getMonth()];
        document.querySelector(".date p").innerHTML = new Date().toLocaleDateString('pt-BR', dateBr);
        document.querySelector(".date h2").innerHTML = date.getFullYear();

        let days = "";

        for (let x = firstDayIndex; x > 0; x--) {
            days += `<div class="prev-date">${prevLastDay - x + 1}</div>`;
        }

        for (let i = 1; i <= lastDay; i++) {
            const dayDate = new Date(date.getFullYear(), date.getMonth(), i);
            const formattedDate = dayDate.toISOString().split('T')[0];
            const isToday = i === new Date().getDate() && date.getMonth() === new Date().getMonth() && date.getFullYear() === new Date().getFullYear();

            let dayClass = isToday ? "today" : "";

            if (events.some(event => event.data === formattedDate)) {
                dayClass += " event-day";
            }

            days += `<div class="${dayClass}" data-date="${formattedDate}">${i}</div>`;
        }

        for (let j = 1; j <= nextDays; j++) {
            days += `<div class="next-date">${j}</div>`;
        }

        monthDays.innerHTML = days;

        const daysElements = document.querySelectorAll(".days div");
        daysElements.forEach(day => {
            day.addEventListener("dblclick", () => {
                const selectedDate = day.getAttribute("data-date");
                const selectedEvents = events.filter(event => event.data === selectedDate);
                
                document.getElementById("eventForm").style.display = "block";
                document.getElementById("data").value = selectedDate;
        
                const eventList = document.getElementById("eventList");
                eventList.innerHTML = "";
                selectedEvents.forEach(event => {
                    const listItem = document.createElement("li");
                    listItem.innerHTML = `${event.disciplina__nome}<br>${event.titulo}<br>${event.descricao}<br>Horário: ${event.horario.slice(0, -3)}`;
                    eventList.appendChild(listItem);
                });
            });
        });


    };

    document.querySelector(".prev").addEventListener("click", () => {
        date.setMonth(date.getMonth() - 1);
        renderCalendar();
    });

    document.querySelector(".next").addEventListener("click", () => {
        date.setMonth(date.getMonth() + 1);
        renderCalendar();
    });

    renderCalendar();
</script>

<style>
 
    .event-day {
        background-color: #FFD700; /* Cor de fundo dourada para dias com eventos */
        color: #000; /* Cor do texto */
    }

    .today {
        background-color: #FF4500; /* Cor de fundo laranja para o dia atual */
        color: #FFF; /* Cor do texto */
    }

    .event-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
        width: 100%;
            
    }
    .event-form {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        max-width: 400px;
        width: 100%;
        background-color: #3d3132;
        
    }
    
    .event-form form {
        display: flex;
        flex-direction: column;
    }
    
    .event-form label {
        margin-top: 10px;
        color: #ccc;
    }
    
    .event-form input[type="text"],
    .event-form input[type="date"],
    .event-form input[type="time"],
    .event-form select,
    .event-form textarea {
        width: 100%;
        padding: var(--input-btn-padding-y) var(--input-btn-padding-x);
        margin-top: 5px;
        border: var(--input-btn-border-width) solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
        font-family: var(--input-btn-font-family);
        font-size: var(--input-btn-font-size);
        line-height: var(--input-btn-line-height);
        
    }
    
    .event-form textarea {
        resize: vertical;
        height: 100px;
    }
    
    .event-form button {
        margin-top: 20px;
        padding: var(--input-btn-padding-y) var(--input-btn-padding-x);
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: var(--input-btn-font-size);
        line-height: var(--input-btn-line-height);
    }
    
    .event-form button:hover {
        background-color: #45a049;
    }
    
    .event-form input:focus,
    .event-form textarea:focus,
    .event-form select:focus {
        outline: var(--input-btn-focus-width) solid var(--input-btn-focus-color);
        box-shadow: var(--input-btn-focus-box-shadow);
    }
    
</style>

{% endblock content %}
